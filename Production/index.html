<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Ã‰diteur de Points 3D</title>
  <!-- IMPORTANT: La bibliothÃ¨que Three.js et OrbitControls seront chargÃ©es ici par votre JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://unpkg.com/three@0.128.0/examples/js/controls/TransformControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <!-- Ajout de Font Awesome pour les icÃ´nes -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32" />
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>
  <div id="splashScreen" class="splash-hidden">
    <span id="splashMessage"></span>
  </div>

  <div id="tooltip"></div>

  <button id="openBtn" class="burger-btn show" onclick="togglePanel()">
    <span class="burger-line"></span>
    <span class="burger-line"></span>
    <span class="burger-line"></span>
  </button>
  <div id="container">
    <div id="cameraControls">
      <div id="snapControl" style="
            position: absolute;
            top: 20px;
            right: 70px;
            z-index: 990;
            background: var(--panel-bg);
            padding: 5px 5px 5px 10px;
            border-radius: 4px;
            border: 1px solid var(--input-border);
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 5px var(--shadow-color);
          ">
        <!-- Checkbox cachÃ©e pour le toggle ON/OFF -->
        <input type="checkbox" id="snapToggle" onchange="toggleSnapping()" style="display: none" />

        <!-- Label cliquable pour activer/dÃ©sactiver -->
        <label for="snapToggle" style="
              font-size: 13px;
              margin: 0;
              cursor: pointer;
              color: var(--text-color);
              display: flex;
              align-items: center;
            " title="Activer/DÃ©sactiver l'aimant">
          <span id="snapIcon" class="icon-disabled">ğŸ§²</span>
          <span style="margin-left: 5px; font-weight: bold">Aimant</span>
        </label>

        <!-- SÃ©parateur visuel -->
        <div style="width: 1px; height: 20px; background-color: var(--input-border)"></div>

        <!-- Liste dÃ©roulante pour la taille -->
        <select id="snapSizeSelect" onchange="updateSnapSize()" style="
              width: auto;
              padding: 2px 5px;
              margin: 0;
              height: 26px;
              border: none;
              background: transparent;
              color: var(--text-color);
              font-size: 13px;
              cursor: pointer;
              outline: none;
              font-weight: bold;
            ">
          <option value="1">1.0</option>
          <option value="0.5">0.5</option>
          <option value="0.1">0.1</option>
        </select>
      </div>

      <!-- Vue de dessus (XY) : La face supÃ©rieure du cube est noire -->
      <div class="camera-btn" id="btnTop" onclick="setCameraView('top', this)" title="Vue de dessus (XY)">
        <svg width="40" height="40" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
          <!-- Face du dessus (noire) -->
          <polygon points="5,15 25,5 45,15 25,25" fill="#222222" />
          <!-- Face de droite (claire) -->
          <polygon points="45,15 45,35 25,45 25,25" fill="#e6e6e6" />
          <!-- Face de gauche (moyenne) -->
          <polygon points="5,15 5,35 25,45 25,25" fill="#cacaca" />
        </svg>
      </div>

      <!-- Vue de face (XZ) : La face de "gauche" (qui reprÃ©sente l'avant) est noire -->
      <div class="camera-btn" id="btnFront" onclick="setCameraView('front', this)" title="Vue de face (XZ)">
        <svg width="40" height="40" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
          <!-- Face du dessus (moyenne) -->
          <polygon points="5,15 25,5 45,15 25,25" fill="#cacaca" />
          <!-- Face de droite (claire) -->
          <polygon points="45,15 45,35 25,45 25,25" fill="#e6e6e6" />
          <!-- Face de gauche/avant (noire) -->
          <polygon points="5,15 5,35 25,45 25,25" fill="#222222" />
        </svg>
      </div>

      <!-- Vue de cÃ´tÃ© (YZ) : La face de "droite" (qui reprÃ©sente le cÃ´tÃ©) est noire -->
      <div class="camera-btn" id="btnSide" onclick="setCameraView('side', this)" title="Vue de cÃ´tÃ© (YZ)">
        <svg width="40" height="40" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
          <!-- Face du dessus (moyenne) -->
          <polygon points="5,15 25,5 45,15 25,25" fill="#cacaca" />
          <!-- Face de droite/cÃ´tÃ© (noire) -->
          <polygon points="45,15 45,35 25,45 25,25" fill="#222222" />
          <!-- Face de gauche (claire) -->
          <polygon points="5,15 5,35 25,45 25,25" fill="#e6e6e6" />
        </svg>
      </div>

      <div class="camera-btn" id="btnReset" onclick="resetCamera(this)" title="RÃ©initialiser la vue (IsomÃ©trique)">
        <i class="fas fa-sync-alt"></i>
      </div>
      <div class="camera-btn" id="btnUndo" onclick="undo()" title="Annuler (Ctrl+Z)"
        style="opacity: 0.5; pointer-events: none">
        <i class="fas fa-undo"></i>
      </div>
      <div class="camera-btn" id="btnRedo" onclick="redo()" title="RÃ©tablir (Ctrl+Y)"
        style="opacity: 0.5; pointer-events: none">
        <i class="fas fa-redo"></i>
      </div>
    </div>
    <div id="panel" class="hidden">
      <div id="panelHeader">
        <button id="toggleBtn" class="burger-btn" onclick="togglePanel()">
          <span class="burger-line"></span>
          <span class="burger-line"></span>
          <span class="burger-line"></span>
        </button>
        <button id="themeToggleBtn" onclick="toggleTheme()" title="Changer le thÃ¨me">
          <i class="fas fa-moon"></i>
        </button>
      </div>
      <div class="section collapsible collapsed">
        <div class="section-header">
          <h3 style="font-size: 16px">ğŸ’¾ Gestion des ScÃ¨nes</h3>
        </div>
        <div class="section-content">
          <label>Nom de la scÃ¨ne :</label>
          <input type="text" id="sceneNameInput" placeholder="Ex: Ma ScÃ¨ne 1" />
          <button class="btn-secondary" onclick="saveScene()">ğŸ’¾ Enregistrer la scÃ¨ne</button>

          <h4 class="sub-section-title" style="margin-top: 20px">Charger une scÃ¨ne :</h4>
          <label>ScÃ¨nes sauvegardÃ©es :</label>
          <select id="savedScenesSelect" style="margin-bottom: 8px"></select>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px">
            <button class="btn-violet" onclick="loadScene()">ğŸ”„ Charger</button>
            <button class="btn-danger" onclick="deleteScene()">ğŸ—‘ï¸ Supprimer</button>
          </div>
          <button class="btn-warning" style="margin-top: 15px; background-color: #607d8b" onclick="downloadDebugJSON()">
            ğŸ Exporter JSON (Debug)
          </button>
          <div style="margin-top: 15px; border-top: 1px solid #ddd; padding-top: 10px">
            <h4 class="sub-section-title">Fichiers de sauvegarde (.json) :</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px">
              <!-- Bouton Exporter -->
              <button class="btn-secondary" style="background-color: #009688" onclick="exportSceneToJSON()">
                ğŸ“¤ Exporter
              </button>

              <!-- Bouton Importer (dÃ©clenche l'input cachÃ©) -->
              <button class="btn-violet" onclick="document.getElementById('importFileInput').click()">
                ğŸ“¥ Importer
              </button>
            </div>

            <!-- Input fichier cachÃ© pour l'import -->
            <input type="file" id="importFileInput" accept=".json" style="display: none"
              onchange="importSceneFromJSON(this)" />
          </div>
        </div>
      </div>

      <div class="section collapsible collapsed">
        <div class="section-header">
          <h3 style="font-size: 16px">ğŸ“ Tracer des points</h3>
        </div>
        <div class="section-content">
          <label>Nom du point :</label>
          <input type="text" id="pointName" placeholder="Ex: A, Point1..." />

          <label style="margin-top: 10px">CoordonnÃ©es (X, Y, Z) :</label>
          <div class="coord-inputs">
            <input type="number" id="pointX" placeholder="X" step="1" />
            <input type="number" id="pointY" placeholder="Y (Profondeur)" step="1" />
            <input type="number" id="pointZ" placeholder="Z (Hauteur)" step="1" />
          </div>

          <!-- Bouton d'ajout de point, visible par dÃ©faut -->
          <button id="addPointBtn" onclick="addPoint()">â• Ajouter le point</button>

          <!-- NOUVEAU : Conteneur pour les boutons d'action d'Ã©dition des points -->
          <input type="hidden" id="editPointIndex" />
          <div id="pointEditActions" class="edit-actions-container" style="display: none">
            <button id="updatePointBtn" class="btn-secondary" onclick="updatePoint()">ğŸ’¾ Mettre Ã  jour</button>
            <button id="deleteEditingPointBtn" class="btn-danger" onclick="deleteEditingPoint()">ğŸ—‘ï¸ Supprimer</button>
            <button id="cancelEditBtn" class="btn-warning" onclick="cancelEdit()">âŒ Annuler</button>
          </div>
        </div>
        <div class="section-content">
          <div id="pointList" class="point-list"></div>
          <button class="btn-danger" onclick="clearAllPoints()">ğŸ—‘ï¸ Effacer tous les points</button>
        </div>
        <div class="section-content">
          <div class="checkbox-group">
            <input type="checkbox" id="autoLoadTestPointsCheckbox" onchange="toggleAutoLoadTestPoints()" />
            <label for="autoLoadTestPointsCheckbox">Charger A, B, C au dÃ©marrage</label>
          </div>
          <button class="btn-secondary" onclick="loadTestPointsOnce()">â• Charger points A, B, C maintenant</button>
          <p style="font-size: 11px; color: #666; margin-top: 5px"></p>
        </div>
      </div>

      <div class="section collapsible collapsed">
        <div class="section-header">
          <h3 style="font-size: 16px">â†—ï¸ Tracer des vecteurs</h3>
        </div>
        <div class="section-content">
          <h4 class="sub-section-title">Vecteur entre deux points :</h4>
          <label>Point de dÃ©part :</label>
          <select id="vectorStartPoint"></select>

          <label style="margin-top: 10px">Point d'arrivÃ©e :</label>
          <select id="vectorEndPoint"></select>

          <button id="addVectorFromPointsBtn" class="btn-secondary" onclick="addVectorFromPoints()">
            â• Tracer le vecteur
          </button>

          <h4 class="sub-section-title">Vecteur par coordonnÃ©es :</h4>
          <label>Nom du vecteur :</label>
          <input type="text" id="vectorNameCoords" placeholder="Ex: V1, Direction..." />
          <label style="margin-top: 10px; color: #2196f3">Origine du vecteur (Ox, Oy, Oz) :</label>
          <div class="coord-inputs">
            <input type="number" id="vectorOriginX" placeholder="Ox" step="1" />
            <input type="number" id="vectorOriginY" placeholder="Oy (Prof.)" step="1" />
            <input type="number" id="vectorOriginZ" placeholder="Oz (Haut.)" step="1" />
          </div>
          <label style="margin-top: 10px">CoordonnÃ©es (Vx, Vy, Vz) :</label>
          <div class="coord-inputs">
            <input type="number" id="vectorCoordX" placeholder="Vx" step="1" />
            <input type="number" id="vectorCoordY" placeholder="Vy" step="1" />
            <input type="number" id="vectorCoordZ" placeholder="Vz" step="1" />
          </div>

          <label style="margin-top: 10px">Origine du vecteur :</label>
          <select id="vectorOriginPoint"></select>
          <button id="addVectorFromCoordsBtn" class="btn-secondary" onclick="addVectorFromCoords()">
            â• Tracer le vecteur
          </button>

          <input type="hidden" id="editVectorId" />

          <!-- NOUVEAU : Conteneur pour les boutons d'action d'Ã©dition -->
          <div id="vectorEditActions" class="edit-actions-container" style="display: none">
            <button id="updateVectorBtn" class="btn-secondary" onclick="updateVector()">ğŸ’¾ Mettre Ã  jour</button>
            <button id="deleteEditingVectorBtn" class="btn-danger" onclick="deleteEditingVector()">
              ğŸ—‘ï¸ Supprimer
            </button>
            <button id="cancelVectorEditBtn" class="btn-warning" onclick="cancelVectorEdit()">âŒ Annuler</button>
          </div>

          <h4 class="sub-section-title">Vecteurs existants :</h4>
          <div id="vectorList" class="geometry-list"></div>
          <button class="btn-danger" onclick="clearAllVectors()">ğŸ—‘ï¸ Effacer tous les vecteurs</button>
        </div>
      </div>

      <div class="section collapsible collapsed">
        <div class="section-header">
          <h3 style="font-size: 16px">ğŸ“ Tracer des droites</h3>
        </div>
        <div class="section-content">
          <h4 class="sub-section-title">Droite par deux points :</h4>
          <label>Premier point :</label>
          <select id="lineStart"></select>
          <label style="margin-top: 10px">DeuxiÃ¨me point :</label>
          <select id="lineEnd"></select>
          <button class="btn-secondary" onclick="addStraightLine()">â• Tracer la droite</button>

          <h4 class="sub-section-title">Droite par Point et Vecteur :</h4>
          <label>Nom de la droite :</label>
          <input type="text" id="lineNamePV" placeholder="Ex: D1, Delta..." />

          <div class="coord-inputs" style="grid-template-columns: 1fr 1fr; gap: 8px">
            <div>
              <label style="font-size: 11px">Point de passage :</label>
              <select id="linePointPVSelect"></select>
            </div>
            <div>
              <label style="font-size: 11px">Vecteur directeur :</label>
              <select id="lineVectorPVSelect"></select>
            </div>
          </div>

          <button class="btn-secondary" onclick="addLineFromPointVector()">
            â• Tracer la droite (Point + Vecteur)
          </button>

          <!-- DÃ‰BUT MODIFICATION Ã‰TAPE 1 : UI pour Droite par Ã©quation -->
          <h4 class="sub-section-title">Droite par Ã©quation paramÃ©trique :</h4>
          <label>Nom de la droite :</label>
          <input type="text" id="lineNameFromEquation" placeholder="Ex: D1, MaDroite..." />

          <label style="margin-top: 10px; color: #2196f3">Point de passage (Optionnel) :</label>
          <select id="lineEquationPointSelect" onchange="onLineEquationPointChange()">
            <!-- Sera rempli par JS -->
          </select>

          <label style="font-size: 11px; color: #666">Ou coordonnÃ©es manuelles du point ($P_0$) :</label>
          <div class="coord-inputs">
            <input type="number" id="lineEqPointX" placeholder="Px" step="1" />
            <input type="number" id="lineEqPointY" placeholder="Py (Prof.)" step="1" />
            <input type="number" id="lineEqPointZ" placeholder="Pz (Haut.)" step="1" />
          </div>

          <label style="margin-top: 10px">Ã‰quations (pour le vecteur directeur) :</label>
          <textarea id="lineEquationInput" rows="3" placeholder="x = 2t&#10;y = t&#10;z = -5t"
            style="font-family: monospace"></textarea>

          <input type="hidden" id="editLineId" />

          <!-- Bouton d'ajout existant (ajoutez-lui une ID pour pouvoir le cacher) -->
          <button id="addLineFromEquationBtn" class="btn-secondary" onclick="addLineFromEquation()">
            â• CrÃ©er la droite
          </button>

          <!-- Nouveaux boutons pour l'Ã©dition (cachÃ©s par dÃ©faut) -->
          <div id="lineEquationActions" class="edit-actions-container" style="display: none">
            <button id="updateLineBtn" class="btn-secondary" onclick="updateLine()">ğŸ’¾ Mettre Ã  jour</button>
            <button id="deleteEditingLineBtn" class="btn-danger" onclick="deleteEditingLine()">ğŸ—‘ï¸ Supprimer</button>
            <button id="cancelLineEditBtn" class="btn-warning" onclick="cancelLineEdit()">âŒ Annuler</button>
          </div>

          <h4 class="sub-section-title">Droites existantes :</h4>
          <div id="lineList" class="geometry-list"></div>
          <button class="btn-danger" onclick="clearStraightLines()">ğŸ—‘ï¸ Effacer les droites</button>
        </div>
      </div>

      <div class="section collapsible collapsed">
        <div class="section-header">
          <h3 style="font-size: 16px">ğŸ”· Tracer des plans</h3>
        </div>
        <div class="section-content">
          <h4 class="sub-section-title">Plan par 3 points :</h4>
          <label>Nom du plan :</label>
          <input type="text" id="planeName" placeholder="Ex: P1, MonPlan..." />

          <label style="margin-top: 10px">Premier point :</label>
          <select id="planeSelectP1"></select>

          <label style="margin-top: 10px">DeuxiÃ¨me point :</label>
          <select id="planeSelectP2"></select>

          <label style="margin-top: 10px">TroisiÃ¨me point :</label>
          <select id="planeSelectP3"></select>

          <button class="btn-warning" onclick="addPlane()">â• Ajouter ce plan</button>

          <h4 class="sub-section-title">Plan par vecteur normal (Ã©quation) :</h4>

          <label style="color: #2196f3">Point de passage (Optionnel) :</label>
          <select id="planeEquationPointSelect" onchange="onPlaneEquationPointChange()">
            <!-- Sera rempli par JS -->
          </select>

          <label style="font-size: 11px; color: #666">Ou coordonnÃ©es manuelles ($P_0$) :</label>
          <div class="coord-inputs">
            <input type="number" id="planeEqPointX" placeholder="Px" step="1" />
            <input type="number" id="planeEqPointY" placeholder="Py (Prof.)" step="1" />
            <input type="number" id="planeEqPointZ" placeholder="Pz (Haut.)" step="1" />
          </div>

          <!-- <label style="margin-top: 10px">Ã‰quation (pour le vecteur normal a,b,c) :</label>
          <input type="text" id="planeEquationInput" placeholder="Ex: 2x - y + 3z = 0" />
          <button class="btn-warning" onclick="addPlaneFromEquation()">â• CrÃ©er le plan</button> -->

          <h4 class="sub-section-title">Plan par Ã©quation :</h4>
          <label>Ã‰quation cartÃ©sienne (ax+by+cz+d=0) :</label>
          <input type="text" id="planeEquationInput" placeholder="Ex: 2x - y + 3z - 6 = 0" />
          <button id="addPlaneFromEquationBtn" class="btn-warning" onclick="addPlaneFromEquation()">
            â• CrÃ©er le plan depuis l'Ã©quation
          </button>

          <input type="hidden" id="editPlaneId" />
          <div id="planeEquationActions" class="edit-actions-container" style="display: none">
            <button id="updatePlaneBtn" class="btn-secondary" onclick="updatePlane()">ğŸ’¾ Mettre Ã  jour</button>
            <button id="deleteEditingPlaneBtn" class="btn-danger" onclick="deleteEditingPlane()">ğŸ—‘ï¸ Supprimer</button>
            <button id="cancelPlaneEditBtn" class="btn-warning" onclick="cancelPlaneEdit()">âŒ Annuler</button>
          </div>
          <h4 class="sub-section-title">Plans existants :</h4>
          <div id="planeList" class="geometry-list"></div>
          <button class="btn-danger" onclick="clearAllPlanes()">ğŸ—‘ï¸ Effacer tous les plans</button>
        </div>
      </div>

      <div class="section collapsible collapsed">
        <div class="section-header">
          <h3 style="font-size: 16px">ğŸ“ˆ Ã‰quations gÃ©omÃ©triques</h3>
        </div>
        <div class="section-content">
          <h4 class="sub-section-title">Ã‰quation de plan :</h4>
          <label>SÃ©lectionner un plan pour voir son Ã©quation :</label>
          <select id="equationPlaneSelect" onchange="displayPlaneEquation()"></select>
          <div id="planeEquationDisplay" class="equation-display"></div>

          <h4 class="sub-section-title" style="margin-top: 20px">Ã‰quation paramÃ©trique de droite :</h4>
          <label>SÃ©lectionner une droite pour voir son Ã©quation :</label>
          <select id="equationLineSelect" onchange="displayLineEquation()"></select>

          <div id="lineEquationDisplay" class="equation-display"></div>
        </div>
      </div>

      <div class="section collapsible collapsed">
        <div class="section-header">
          <h3 style="font-size: 16px">ğŸ§® Calculs</h3>
        </div>
        <div class="section-content">
          <!-- Outils de Mesure -->
          <h4 class="sub-section-title" style="margin-top: 20px">OpÃ©rations sur les Vecteurs</h4>

          <!-- Somme de vecteurs -->
          <label>Somme de deux vecteurs \(\vec{u} + \vec{v}\) :</label>
          <div class="coord-inputs" style="grid-template-columns: 1fr 1fr; margin-bottom: 8px">
            <select id="sumVectorSelect1"></select>
            <select id="sumVectorSelect2"></select>
          </div>

          <label>Point de dÃ©part (pour la construction ou le vecteur libre) :</label>
          <select id="sumVectorOrigin" style="margin-bottom: 8px"></select>

          <!-- MODIFICATION: Boutons pour des actions distinctes -->
          <button class="btn-violet" onclick="calculateVectorSumFree()">ğŸ–© CrÃ©er le vecteur somme (libre)</button>
          <button class="btn-warning" onclick="constructChaslesSum()">ğŸ“ Construire la somme (Chasles)</button>

          <!-- NOUVEAU: Bouton pour nettoyer la construction, cachÃ© par dÃ©faut -->
          <button class="btn-danger" onclick="clearChaslesConstruction()" style="display: none; margin-top: 5px"
            id="clearChaslesBtn">
            ğŸ—‘ï¸ Effacer la construction
          </button>

          <div id="vectorSumResult" class="equation-display"></div>

          <!-- Produit Scalaire -->
          <label style="margin-top: 15px">Produit scalaire de deux vecteurs \( \vec{u} \cdot \vec{v} \) :</label>
          <div class="coord-inputs" style="grid-template-columns: 1fr 1fr; margin-bottom: 8px">
            <select id="dotVectorSelect1"></select>
            <select id="dotVectorSelect2"></select>
          </div>
          <button class="btn-warning" onclick="calculateScalarProduct()">ğŸ–© Calculer</button>
          <div id="scalarProductResult" class="equation-display"></div>

          <!-- Produit Vectoriel -->
          <label style="margin-top: 15px">Produit vectoriel de deux vecteurs \( \vec{u} \wedge \vec{v} \) :</label>
          <div class="coord-inputs" style="grid-template-columns: 1fr 1fr; margin-bottom: 8px">
            <select id="crossVectorSelect1"></select>
            <select id="crossVectorSelect2"></select>
          </div>
          <label>Origine du vecteur produit :</label>
          <select id="crossVectorOrigin" style="margin-bottom: 8px"></select>
          <button class="btn-warning" onclick="calculateVectorProduct()">ğŸ–© CrÃ©er le vecteur produit</button>
          <div id="vectorProductResult" class="equation-display"></div>
          <h4 class="sub-section-title" style="margin-top: 20px">Projection Orthogonale</h4>
          <label>Projeter le point :</label>
          <select id="projPointSelect"></select>
          <label>Sur le plan :</label>
          <select id="projPlaneSelect"></select>
          <button class="btn-violet" onclick="projectPointOnPlane()">ğŸ“ Projeter</button>
        </div>
      </div>

      <div class="section collapsible collapsed">
        <div class="section-header">
          <h3 style="font-size: 16px">ğŸ“ Mesures et Intersections</h3>
        </div>
        <div class="section-content">
          <!-- Outils de Mesure -->
          <h4 class="sub-section-title">Mesure de Distances</h4>

          <!-- Distance Point-Point -->
          <label>Distance entre deux points :</label>
          <div class="coord-inputs" style="grid-template-columns: 1fr 1fr; margin-bottom: 8px">
            <select id="distPointSelect1"></select>
            <select id="distPointSelect2"></select>
          </div>
          <button class="btn-warning" onclick="calculatePointPointDistance()">ğŸ–© Mesurer</button>
          <div id="distResult1" class="equation-display"></div>

          <!-- Distance Point-Droite -->
          <label style="margin-top: 15px">Distance d'un point Ã  une droite :</label>
          <div class="coord-inputs" style="grid-template-columns: 1fr 1fr; margin-bottom: 8px">
            <select id="distPointSelect3"></select>
            <select id="distLineSelect1"></select>
          </div>
          <button class="btn-warning" onclick="calculatePointLineDistance()">ğŸ–© Mesurer</button>
          <div id="distResult2" class="equation-display"></div>

          <!-- Distance Point-Plan -->
          <label style="margin-top: 15px">Distance d'un point Ã  un plan :</label>
          <div class="coord-inputs" style="grid-template-columns: 1fr 1fr; margin-bottom: 8px">
            <select id="calcPointSelect"></select>
            <select id="calcPlaneSelect1"></select>
          </div>
          <button class="btn-warning" onclick="calculatePointPlaneDistance()">ğŸ–© Mesurer et projeter</button>
          <div id="calcResultDisplay1" class="equation-display" style="min-height: 50px"></div>

          <!-- Outils d'Angle -->
          <h4 class="sub-section-title" style="margin-top: 20px">Mesure d'Angles</h4>

          <!-- Angle Droite-Droite -->
          <label>Angle entre deux droites :</label>
          <div class="coord-inputs" style="grid-template-columns: 1fr 1fr; margin-bottom: 8px">
            <select id="angleLineSelect1"></select>
            <select id="angleLineSelect2"></select>
          </div>
          <button class="btn-warning" onclick="calculateLineLineAngle()">ğŸ–© Mesurer</button>
          <div id="angleResult1" class="equation-display"></div>

          <!-- Angle Plan-Plan -->
          <label style="margin-top: 15px">Angle entre deux plans :</label>
          <div class="coord-inputs" style="grid-template-columns: 1fr 1fr; margin-bottom: 8px">
            <select id="anglePlaneSelect1"></select>
            <select id="anglePlaneSelect2"></select>
          </div>
          <button class="btn-warning" onclick="calculatePlanePlaneAngle()">ğŸ–© Mesurer</button>
          <div id="angleResult2" class="equation-display"></div>

          <!-- Angle Droite-Plan -->
          <label style="margin-top: 15px">Angle entre une droite et un plan :</label>
          <div class="coord-inputs" style="grid-template-columns: 1fr 1fr; margin-bottom: 8px">
            <select id="angleLineSelect3"></select>
            <select id="anglePlaneSelect3"></select>
          </div>
          <button class="btn-warning" onclick="calculateLinePlaneAngle()">ğŸ–© Mesurer</button>
          <div id="angleResult3" class="equation-display"></div>

          <!-- Intersections -->
          <h4 class="sub-section-title" style="margin-top: 20px">Calcul d'Intersections</h4>

          <!-- Intersection Droite-Plan -->
          <label>Intersection d'une droite et d'un plan :</label>
          <div class="coord-inputs" style="grid-template-columns: 1fr 1fr; margin-bottom: 8px">
            <select id="calcLineSelect"></select>
            <select id="calcPlaneSelect2"></select>
          </div>
          <button class="btn-warning" onclick="calculateLinePlaneIntersection()">ğŸ–© Calculer l'intersection</button>
          <div id="calcResultDisplay2" class="equation-display"></div>

          <!-- Intersection Plan-Plan -->
          <label style="margin-top: 15px">Intersection de deux plans :</label>
          <div class="coord-inputs" style="grid-template-columns: 1fr 1fr; margin-bottom: 8px">
            <select id="calcPlaneSelect3"></select>
            <select id="calcPlaneSelect4"></select>
          </div>
          <button class="btn-warning" onclick="calculatePlanePlaneIntersection()">ğŸ–© Calculer l'intersection</button>
          <div id="calcResultDisplay3" class="equation-display" style="min-height: 60px"></div>

          <!-- Intersection Droite-Droite -->
          <h4 class="sub-section-title" style="margin-top: 20px">Intersection de deux droites :</h4>
          <label>SÃ©lectionner les deux droites :</label>
          <div class="coord-inputs" style="grid-template-columns: 1fr 1fr; margin-bottom: 8px">
            <select id="calcLineSelect1"></select>
            <select id="calcLineSelect2"></select>
          </div>
          <button class="btn-warning" onclick="calculateLineLineIntersection()">ğŸ–© Analyser l'intersection</button>
          <div id="calcResultDisplay4" class="equation-display" style="margin-top: 10px; min-height: 50px"></div>

          <h4 class="sub-section-title" style="margin-top: 20px">Perpendiculaire commune (Droites)</h4>
          <div class="coord-inputs" style="grid-template-columns: 1fr 1fr; margin-bottom: 8px">
            <select id="perpLine1"></select>
            <select id="perpLine2"></select>
          </div>
          <button class="btn-warning" onclick="calculateCommonPerpendicular()">ğŸ–© Tracer la perpendiculaire</button>
          <div id="perpResult" class="equation-display"></div>
        </div>
      </div>

      <div class="section collapsible collapsed">
        <div class="section-header">
          <h3 style="font-size: 16px">ğŸ”„ Transformations</h3>
        </div>
        <div class="section-content">
          <p id="transformations-hint" style="font-size: 12px; color: #888; text-align: center">
            Veuillez faire un clic droit sur un objet dans la scÃ¨ne 3D pour appliquer une transformation.
          </p>

          <!-- Sous-section Translation -->
          <div id="transformations-container" style="display: none">
            <h4 class="sub-section-title">Translation</h4>
            <label>Vecteur de translation (dX, dY, dZ) :</label>
            <div class="coord-inputs">
              <input type="number" id="transX" placeholder="dX" value="0" step="1" />
              <input type="number" id="transY" placeholder="dY" value="0" step="1" />
              <input type="number" id="transZ" placeholder="dZ" value="0" step="1" />
            </div>
            <button class="btn-secondary" onclick="applyTranslation()">â¡ï¸ Appliquer la Translation</button>

            <!-- Sous-section Rotation -->
            <h4 class="sub-section-title" style="margin-top: 20px">Rotation</h4>
            <label>Centre de rotation :</label>
            <select id="rotationCenterSelect">
              <option value="origin">Origine du repÃ¨re (0,0,0)</option>
              <!-- Les points seront ajoutÃ©s dynamiquement ici -->
            </select>
            <label style="margin-top: 10px">Axe de rotation :</label>
            <select id="rotationAxisSelect">
              <option value="x">Axe X</option>
              <option value="y">Axe Y</option>
              <option value="z">Axe Z</option>
            </select>
            <label style="margin-top: 10px">Angle de rotation (en degrÃ©s) :</label>
            <input type="number" id="rotationAngle" value="90" step="1" />
            <button class="btn-secondary" onclick="applyRotation()">ğŸ”„ Appliquer la Rotation</button>

            <!-- Sous-section SymÃ©trie -->
            <h4 class="sub-section-title" style="margin-top: 20px">SymÃ©trie</h4>
            <label>SymÃ©trie par rapport Ã  :</label>

            <select id="symmetryTypeSelect" onchange="updateSymmetryUI()">
              <option value="origin">Origine (0,0,0)</option>

              <option value="axis_x">Axe X</option>
              <option value="axis_y">Axe Y (Profondeur)</option>
              <option value="axis_z">Axe Z (Hauteur)</option>

              <option value="plane_xy">Plan XY (Sol)</option>
              <option value="plane_xz">Plan XZ (Face)</option>
              <option value="plane_yz">Plan YZ (CÃ´tÃ©)</option>
              <option value="">-- Choisir un type --</option>
              <option value="point">Un Point</option>
              <option value="line">Une Droite</option>
              <option value="plane">Un Plan</option>
            </select>
            <div id="symmetryOptionsContainer" style="margin-top: 10px">
              <!-- Les options (sÃ©lecteurs de point, droite, plan) apparaÃ®tront ici -->
            </div>
            <button class="btn-secondary" id="applySymmetryBtn" style="display: none" onclick="applySymmetry()">
              ğŸ”¹ Appliquer la SymÃ©trie
            </button>
          </div>
        </div>
      </div>
      <div style="text-align: center; font-size: 10px; color: #888; margin-top: 20px; padding-top: 5px">
        Copyright Michel ESPARSA 15/11/2025
      </div>

      <div id="contextMenu" class="context-menu" style="display: none">
        <ul id="contextMenuItems" class="context-menu-items">
          <!-- Les options du menu seront injectÃ©es ici par JavaScript -->
        </ul>
      </div>
    </div>

    <!-- =========================================
     NOUVEAU : PANNEAU TABLEUR (BAS)
     ========================================= -->
    <div id="spreadsheetContainer" class="spreadsheet-hidden">
      <div class="spreadsheet-header">
        <div class="spreadsheet-tabs">
          <button class="tab-btn active" onclick="switchSpreadsheetTab('points')">Points</button>
          <button class="tab-btn" onclick="switchSpreadsheetTab('vectors')">Vecteurs</button>
          <button class="tab-btn" onclick="switchSpreadsheetTab('lines')">Droites</button>
          <button class="tab-btn" onclick="switchSpreadsheetTab('planes')">Plans</button>
        </div>
        <div class="spreadsheet-controls">
          <button class="close-spreadsheet-btn" onclick="toggleSpreadsheet()">â–¼ Fermer</button>
        </div>
      </div>
      <div class="spreadsheet-body">
        <table id="spreadsheetTable">
          <thead>
            <!-- Les en-tÃªtes seront gÃ©nÃ©rÃ©s par JS -->
          </thead>
          <tbody>
            <!-- Le contenu sera gÃ©nÃ©rÃ© par JS -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <!-- Bouton flottant pour ouvrir le tableur (en bas Ã  gauche) -->
  <button id="openSpreadsheetBtn" onclick="toggleSpreadsheet()">ğŸ“… Tableur de donnÃ©es</button>

  <script src="js/app.js"></script>
</body>

</html>
